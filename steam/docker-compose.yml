services:
  endless-sky-x64:
    build:
      context: .
      args:
        runtime: scout
    volumes:
      - '../.:/endless-sky'
    command:
      - '/bin/bash'
      - '-c'
      - |
        mkdir -p build/steam-x64
        cd build/steam-x64
        cmake ../../ -DCMAKE_CXX_COMPILER=g++-9 -DES_STEAM=ON -DES_RELEASE=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS=-no-pie
        make -j $$(nproc) EndlessSky EndlessSkyTests
        ./endless-sky --version
        ./endless-sky-tests


  endless-sky-x86:
    build:
      context: .
      args:
        arch: /i386
        runtime: scout
    volumes:
      - '../.:/endless-sky'
    command:
      - '/bin/bash'
      - '-c'
      - |
        mkdir -p build/steam-x86
        cd build/steam-x86
        cmake ../../ -DCMAKE_CXX_COMPILER=g++-9 -DES_STEAM=ON -DES_RELEASE=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS=-no-pie
        make -j $$(nproc) EndlessSky EndlessSkyTests
        ./endless-sky --version
        ./endless-sky-tests
